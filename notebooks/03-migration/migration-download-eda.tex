% Options for packages loaded elsewhere
% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{report}
\usepackage{xcolor}
\usepackage{amsmath,amssymb}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Migration Data Download},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{Migration Data Download}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{Get Tasiagnunpa occurrence data from the Global Biodiversity
Information Facility (GBIF)}
\author{}
\date{}
\begin{document}
\maketitle


Before we get started, let's define some parameters for the workflow.
We'll use these throughout to customize the workflow for this species:

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{id} \OperatorTok{=} \StringTok{\textquotesingle{}eda\textquotesingle{}}
\NormalTok{project\_title }\OperatorTok{=} \StringTok{\textquotesingle{}Veery Migration 2024\textquotesingle{}}
\NormalTok{species\_name }\OperatorTok{=} \StringTok{\textquotesingle{}Veery\textquotesingle{}}
\NormalTok{species\_lookup }\OperatorTok{=} \StringTok{\textquotesingle{}catharus fuscescens\textquotesingle{}}
\NormalTok{species\_key }\OperatorTok{=} \DecValTok{2490804}
\NormalTok{year }\OperatorTok{=} \DecValTok{2024}
\NormalTok{project\_dirname }\OperatorTok{=} \StringTok{\textquotesingle{}veery{-}migration\textquotesingle{}}
\NormalTok{gbif\_filename }\OperatorTok{=} \StringTok{\textquotesingle{}gbif\_veery.csv\textquotesingle{}}
\NormalTok{ecoregions\_dir }\OperatorTok{=} \StringTok{\textquotesingle{}wwf\_ecoregions\textquotesingle{}}
\NormalTok{plot\_filename }\OperatorTok{=} \StringTok{\textquotesingle{}veery\_migration\textquotesingle{}}
\NormalTok{plot\_height }\OperatorTok{=} \DecValTok{700}
\end{Highlighting}
\end{Shaded}

\section{Access locations and times of Veery
encounters}\label{access-locations-and-times-of-encounters}

For this challenge, you will use a database called the
\href{https://www.gbif.org/}{Global Biodiversity Information Facility
(GBIF)}. GBIF is compiled from species observation data all over the
world, and includes everything from museum specimens to photos taken by
citizen scientists in their backyards.

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It: Explore GBIF}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

Before your get started, go to the
\href{https://www.gbif.org/occurrence/search}{GBIF occurrences search
page} and explore the data.

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-tip-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-tip-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{Contribute to open data}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

You can get your own observations added to GBIF using
\href{https://www.inaturalist.org/}{iNaturalist}!

\end{tcolorbox}

\subsection{Set up your code to prepare for
download}\label{set-up-your-code-to-prepare-for-download}

We will be getting data from a source called
\href{https://www.gbif.org/}{GBIF (Global Biodiversity Information
Facility)}. We need a package called \texttt{pygbif} to access the data,
which may not be included in your environment. Install it by running the
cell below:

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\%\%}\NormalTok{bash}
\NormalTok{pip install pygbif}
\end{Highlighting}
\end{Shaded}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It: Import packages}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

In the imports cell, we've included some packages that you will need.
Add imports for packages that will help you:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Work with reproducible file paths
\item
  Work with tabular data
\end{enumerate}

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ time}
\ImportTok{import}\NormalTok{ zipfile}
\ImportTok{from}\NormalTok{ getpass }\ImportTok{import}\NormalTok{ getpass}
\ImportTok{from}\NormalTok{ glob }\ImportTok{import}\NormalTok{ glob}

\ImportTok{import}\NormalTok{ pygbif.occurrences }\ImportTok{as}\NormalTok{ occ}
\ImportTok{import}\NormalTok{ pygbif.species }\ImportTok{as}\NormalTok{ species}
\ImportTok{import}\NormalTok{ requests}
\end{Highlighting}
\end{Shaded}

\subsection{Create a directory for your
data}\label{create-a-directory-for-your-data}

For this challenge, you will need to download some data to the computer
you're working on. We suggest using the \texttt{earthpy} library we
develop to manage your downloads, since it encapsulates many best
practices as far as:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Where to store your data
\item
  Dealing with archived data like .zip files
\item
  Avoiding version control problems
\item
  Making sure your code works cross-platform
\item
  Avoiding duplicate downloads
\end{enumerate}

If you're working on one of our assignments through GitHub Classroom, it
also lets us build in some handy defaults so that you can see your data
files while you work.

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It: Create a project folder}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

The code below will help you get started with making a project directory

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Replace
  \texttt{\textquotesingle{}your-project-directory-name-here\textquotesingle{}}
  with a \textbf{descriptive} name
\item
  Run the cell
\item
  The code should have printed out the path to your data files. Check
  that your data directory exists and has data in it using the terminal
  or your Finder/File Explorer.
\end{enumerate}

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-tip-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-tip-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{File structure}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

These days, a lot of people find your file by searching for them or
selecting from a \texttt{Bookmarks} or \texttt{Recents} list. Even if
you don't use it, your computer also keeps files in a \textbf{tree}
structure of folders. Put another way, you can organize and find files
by travelling along a unique \textbf{path}, e.g.~\texttt{My\ Drive}
\textgreater{} \texttt{Documents} \textgreater{}
\texttt{My\ awesome\ project} \textgreater{} \texttt{A\ project\ file}
where each subsequent folder is \textbf{inside} the previous one. This
is convenient because all the files for a project can be in the same
place, and both people and computers can rapidly locate files they want,
provided they remember the path.

You may notice that when Python prints out a file path like this, the
folder names are \textbf{separated} by a \texttt{/} or
\texttt{\textbackslash{}} (depending on your operating system). This
character is called the \textbf{file separator}, and it tells you that
the next piece of the path is \textbf{inside} the previous one.

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create data directory}
\NormalTok{project }\OperatorTok{=}\NormalTok{ earthpy.Project(}
\NormalTok{    dirname}\OperatorTok{=}\StringTok{\textquotesingle{}your{-}project{-}directory{-}name{-}here\textquotesingle{}}\NormalTok{)}
\CommentTok{\# Download sample data}
\NormalTok{project.get\_data()}

\CommentTok{\# Display the project directory}
\NormalTok{project.project\_dir}
\end{Highlighting}
\end{Shaded}

\subsection{Register and log in to
GBIF}\label{register-and-log-in-to-gbif}

You will need a \href{https://www.gbif.org/}{GBIF account} to complete
this challenge. You can use your GitHub account to authenticate with
GBIF. Then, run the following code to enter your credentials for the
rest of your session.

This code is \textbf{interactive}, meaning that it will \textbf{ask you
for a response}! The prompt can sometimes be hard to see if you are
using VSCode -- it appears at the \textbf{top} of your editor window.

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-tip-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-tip-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{Tip}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

If you need to save credentials across multiple sessions, you can
consider loading them in from a file like a \texttt{.env}\ldots but make
sure to add it to .gitignore so you don't commit your credentials to
your repository!

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-warning-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-warning-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-warning-color}{\faExclamationTriangle}\hspace{0.5em}{Warning}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

Your email address \textbf{must} match the email you used to sign up for
GBIF!

\end{tcolorbox}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-tip-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-tip-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-tip-color}{\faLightbulb}\hspace{0.5em}{Tip}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

If you accidentally enter your credentials wrong, you can set
\texttt{reset=True} instead of \texttt{reset=False}.

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#\#{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}\#\#\#\#}
\CommentTok{\#\#\#\# DO NOT MODIFY THIS CODE! \#\#\#\#}
\CommentTok{\#\#\#\#{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}\#\#\#\#}
\CommentTok{\# This code ASKS for your credentials }
\CommentTok{\# and saves it for the rest of the session.}
\CommentTok{\# NEVER put your credentials into your code!!!!}

\CommentTok{\# GBIF needs a username, password, and email }
\CommentTok{\# All 3 need to match the account}
\NormalTok{reset }\OperatorTok{=} \VariableTok{False}

\CommentTok{\# Request and store username}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{not}\NormalTok{ (}\StringTok{\textquotesingle{}GBIF\_USER\textquotesingle{}}  \KeywordTok{in}\NormalTok{ os.environ)) }\KeywordTok{or}\NormalTok{ reset:}
\NormalTok{    os.environ[}\StringTok{\textquotesingle{}GBIF\_USER\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \BuiltInTok{input}\NormalTok{(}\StringTok{\textquotesingle{}GBIF username:\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Securely request and store password}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{not}\NormalTok{ (}\StringTok{\textquotesingle{}GBIF\_PWD\textquotesingle{}}  \KeywordTok{in}\NormalTok{ os.environ)) }\KeywordTok{or}\NormalTok{ reset:}
\NormalTok{    os.environ[}\StringTok{\textquotesingle{}GBIF\_PWD\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ getpass(}\StringTok{\textquotesingle{}GBIF password:\textquotesingle{}}\NormalTok{)}
    
\CommentTok{\# Request and store account email address}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{not}\NormalTok{ (}\StringTok{\textquotesingle{}GBIF\_EMAIL\textquotesingle{}}  \KeywordTok{in}\NormalTok{ os.environ)) }\KeywordTok{or}\NormalTok{ reset:}
\NormalTok{    os.environ[}\StringTok{\textquotesingle{}GBIF\_EMAIL\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \BuiltInTok{input}\NormalTok{(}\StringTok{\textquotesingle{}GBIF email:\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Get the species key}\label{get-the-species-key}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Replace the \texttt{species\_name} with the name of the species you
  want to look up
\item
  Run the code to get the species key
\end{enumerate}

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Query species}
\NormalTok{species\_info }\OperatorTok{=}\NormalTok{ species.name\_lookup(}
\NormalTok{    species\_lookup, rank}\OperatorTok{=}\StringTok{\textquotesingle{}SPECIES\textquotesingle{}}\NormalTok{)}

\CommentTok{\# Get the first result}
\NormalTok{first\_result }\OperatorTok{=}\NormalTok{ species\_info[}\StringTok{\textquotesingle{}results\textquotesingle{}}\NormalTok{][}\DecValTok{0}\NormalTok{]}

\CommentTok{\# Get the species key (speciesKey)}
\NormalTok{species\_key }\OperatorTok{=}\NormalTok{ first\_result[}\StringTok{\textquotesingle{}speciesKey\textquotesingle{}}\NormalTok{]}

\CommentTok{\# Check the result}
\NormalTok{first\_result[}\StringTok{\textquotesingle{}species\textquotesingle{}}\NormalTok{], species\_key}
\end{Highlighting}
\end{Shaded}

\subsection{Download data from GBIF}\label{download-data-from-gbif}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It: Submit a request to GBIF}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Replace \texttt{csv\_file\_pattern} with a string that will match
  \textbf{any} \texttt{.csv} file when used in the \texttt{.rglob()}
  method. HINT: the character \texttt{*} represents any number of any
  values except the file separator (e.g.~\texttt{/} on UNIX systems)
\item
  Add parameters to the GBIF download function, \texttt{occ.download()}
  to limit your query to:

  \begin{itemize}
  \tightlist
  \item
    observations of Veery
  \item
    from 2024
  \item
    with spatial coordinates.
  \end{itemize}
\item
  Then, run the download. \textbf{This can take a few minutes}. You can
  check your downloads by logging on to the
  \href{https://www.gbif.org/user/download}{GBIF website}.
\end{enumerate}

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Only download once}
\ControlFlowTok{if} \KeywordTok{not} \BuiltInTok{any}\NormalTok{(project.project\_dir.rglob(csv\_file\_pattern)):}
    \CommentTok{\# Only submit one request}
    \ControlFlowTok{if} \KeywordTok{not} \StringTok{\textquotesingle{}GBIF\_DOWNLOAD\_KEY\textquotesingle{}} \KeywordTok{in}\NormalTok{ os.environ:}
        \CommentTok{\# Submit query to GBIF}
\NormalTok{        gbif\_query }\OperatorTok{=}\NormalTok{ occ.download([}
            \SpecialStringTok{f"speciesKey = "}\NormalTok{,}
            \StringTok{"hasCoordinate = "}\NormalTok{,}
            \StringTok{"year = "}\NormalTok{,}
\NormalTok{        ])}
        \CommentTok{\# Take first result}
\NormalTok{        os.environ[}\StringTok{\textquotesingle{}GBIF\_DOWNLOAD\_KEY\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \BuiltInTok{next}\NormalTok{(}
\NormalTok{            gbif\_query)}

    \CommentTok{\# Wait for the download to build}
\NormalTok{    dld\_key }\OperatorTok{=}\NormalTok{ os.environ[}\StringTok{\textquotesingle{}GBIF\_DOWNLOAD\_KEY\textquotesingle{}}\NormalTok{]}
\NormalTok{    wait }\OperatorTok{=}\NormalTok{ occ.download\_meta(dld\_key)[}\StringTok{\textquotesingle{}status\textquotesingle{}}\NormalTok{]}
    \ControlFlowTok{while} \KeywordTok{not}\NormalTok{ wait}\OperatorTok{==}\StringTok{\textquotesingle{}SUCCEEDED\textquotesingle{}}\NormalTok{:}
\NormalTok{        wait }\OperatorTok{=}\NormalTok{ occ.download\_meta(dld\_key)[}\StringTok{\textquotesingle{}status\textquotesingle{}}\NormalTok{]}
\NormalTok{        time.sleep(}\DecValTok{5}\NormalTok{)}

    \CommentTok{\# Download GBIF data}
\NormalTok{    dld\_info }\OperatorTok{=}\NormalTok{ occ.download\_get(}
\NormalTok{        os.environ[}\StringTok{\textquotesingle{}GBIF\_DOWNLOAD\_KEY\textquotesingle{}}\NormalTok{], }
\NormalTok{        path}\OperatorTok{=}\NormalTok{project.project\_dir)}
\NormalTok{    dld\_path }\OperatorTok{=}\NormalTok{ dld\_info[}\StringTok{\textquotesingle{}path\textquotesingle{}}\NormalTok{]}

    \CommentTok{\# Unzip GBIF data}
    \ControlFlowTok{with}\NormalTok{ zipfile.ZipFile(dld\_path) }\ImportTok{as}\NormalTok{ dld\_zip:}
\NormalTok{        dld\_zip.extractall(path}\OperatorTok{=}\NormalTok{project.project\_dir)}
        
    \CommentTok{\# Clean up the .zip file}
\NormalTok{    os.remove(dld\_path)}

\CommentTok{\# Find the extracted .csv file path (first result)}
\NormalTok{original\_gbif\_path }\OperatorTok{=} \BuiltInTok{next}\NormalTok{(}
\NormalTok{    project.project\_dir.rglob(}\StringTok{\textquotesingle{}*.csv\textquotesingle{}}\NormalTok{))}
\NormalTok{original\_gbif\_path}
\end{Highlighting}
\end{Shaded}

You might notice that the GBIF data filename isn't very
\textbf{descriptive}\ldots at this point, you may want to clean up your
data directory so that you know what the file is later on!

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Replace `your-gbif-filename' with a \textbf{descriptive} name.
\item
  Run the cell
\item
  Check your data folder. Is it organized the way you want?
\end{enumerate}

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Give the download a descriptive name}
\NormalTok{gbif\_path }\OperatorTok{=}\NormalTok{ project.project\_dir }\OperatorTok{/} \StringTok{\textquotesingle{}your{-}gbif{-}filename\textquotesingle{}}
\CommentTok{\# Move file to descriptive path}
\NormalTok{shutil.move(original\_gbif\_path, gbif\_path)}
\end{Highlighting}
\end{Shaded}

\subsection{Load the GBIF data into
Python}\label{load-the-gbif-data-into-python}

\begin{tcolorbox}[enhanced jigsaw, breakable, colframe=quarto-callout-color-frame, toptitle=1mm, bottomrule=.15mm, colbacktitle=quarto-callout-color!10!white, opacityback=0, opacitybacktitle=0.6, coltitle=black, title=\textcolor{quarto-callout-color}{\faInfo}\hspace{0.5em}{Try It: Load GBIF data}, left=2mm, bottomtitle=1mm, titlerule=0mm, arc=.35mm, colback=white, rightrule=.15mm, toprule=.15mm, leftrule=.75mm]

Just like you did when wrangling your data from the data subset, you'll
need to load your GBIF data and convert it to a GeoDataFrame.

\end{tcolorbox}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load the GBIF data}

\CommentTok{\# Convert to GeoDataFrame}

\CommentTok{\# Check results}
\NormalTok{gbif\_gdf.total\_bounds}
\end{Highlighting}
\end{Shaded}

\#{{< include _migration-93-download-wwf.qmd >}}




\end{document}
