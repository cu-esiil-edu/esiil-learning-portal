[
  {
    "objectID": "notebooks/07-phenocam/phenocam.html",
    "href": "notebooks/07-phenocam/phenocam.html",
    "title": "\n                Explore PhenoCam Data\n            ",
    "section": "",
    "text": "Check out our demo video!\n\n\n\n\n \n\nDEMO: Phenocam Workshop (MEFA) by Dr. Alison Post\nSome code adapted from the 2020 NEON Tutorial by Bijan Seyednasrollah",
    "crumbs": [
      "MEFA Phenocam Workshop",
      "Explore PhenoCam Data"
    ]
  },
  {
    "objectID": "notebooks/07-phenocam/phenocam.html#introduction-to-phenocam",
    "href": "notebooks/07-phenocam/phenocam.html#introduction-to-phenocam",
    "title": "\n                Explore PhenoCam Data\n            ",
    "section": "Introduction to PhenoCam",
    "text": "Introduction to PhenoCam\nEstablished in 2008, the PhenoCam Network is a collection of &gt;700 digital cameras that take regular (~ every 30 min) pictures of ecosystem canopies around the world. The name PhenoCam comes from the combination of the words “phenology” and “camera”, because the images are an easy and effective way to study the phenology, or the timing of seasonal changes, of vegetation across diverse ecosystems. The images are available in near-real time to view on the PhenoCam website, and can also be downloaded through the phenocamapi R package, which we’ll cover in this tutorial. There are currently over 60 million images available!\n\n\n\nPhenoCam locations across North America (screenshot from phenocam.nau.edu).\n\n\n\n\n\nIllustration of a PhenoCam (red circle) over a tree canopy collecting phenology data (Image from Richardson (2019), illustrator: Victor Leshyk).\n\n\n\nQuantifying Greenness\nBeyond being pretty pictures, PhenoCam images also provide a quantitative way to track vegetation phenology by measuring the intensity of canopy greenness. Digital images are stored as three different color channels - red, green, and blue (RGB) - which are the primary colors of light, and combine in different ratios to create all the visible colors in a photograph. Old-style TVs use this same method, as does your smartphone.\n\n\n\nThe primary colors of light combine to create all visible colors in digital images.\n\n\nEach digital pixel has a numerical value for each color channel (RGB) that represents its intensity. We can use these values to quantify the relative intensity of green compared to the overall brightness of the image. We call this the Green Chromatic Coordinate (GCC) and calculate it using the equation below.\n\n\n\nEquation to calculate the relative greenness (GCC) of a digital image.\n\n\nHowever, since PhenoCam images usually capture other things besides just the vegetation canopy (e.g., sky, ground, roads, buildings), each site has established portions of the image, or regions of interest (ROIs), that are analyzed for greenness. For example, at this forested site in Canada (lacclair), only the trees in the foreground are included in the GCC calculation:\n\n\n\nExample of an ROI (unshaded portion) for a forest site.\n\n\nAnd at this shrub site, only the shrub plants are included in the ROI and bare ground is excluded.\n\n\n\nROI (unshaded portion) for a shrub site- bare ground is excluded.\n\n\nWhen GCC is calculated over a long time period at a site, a timeseries of vegetation greenness can be created. Below is the GCC timeseries for the “laccair” forest site shown above over the past 9 years. Notice the clear seasonal cycle of vegetation green-up in the spring followed by leaf color change and senescence (brown-down/death) in autumn.\n\n\n\nTimeseries of canopy greeness (GCC) at a forest site in Canada (lacclair).\n\n\n\n\nSeasonal Transition Dates\nThese GCC timeseries can be used to extract seasonal transition dates across the years. For example, to determine the timing of spring green-up, we can use the amplitude (height) of each annual peak to determine when (what day of the year) vegetation at the site has reached either 10%, 25%, or 50% of its maximum greenness. We consider this to be the start of spring green-up. We use a similar method to extract the start of autumn brown-down.\n\n\n\nThe dates of spring green-up (green symbols) and autumn brown-down (brown symbols) can be extracted from the GCC timeseries.\n\n\nOver a long time period, the timing of seasonal transition dates can be used to track shifts in vegetation phenology, such as with climate change. This dataset can also be used to determine which environmental and biologic factors (e.g., temperature, rainfall, sunlight) influence the timing of spring leaf-out and autumn color changes.\n\n\n\nSeasonal transition dates at a deciduous forest site in Canada (lacclair) over the past 9 years.\n\n\n\n\nYour turn!\nThanks for learning about PhenoCam. Now you’ll have the chance to access images and data from a PhenoCam site of your choosing following the tutorial below!",
    "crumbs": [
      "MEFA Phenocam Workshop",
      "Explore PhenoCam Data"
    ]
  },
  {
    "objectID": "notebooks/07-phenocam/phenocam.html#accessing-phenocam-data",
    "href": "notebooks/07-phenocam/phenocam.html#accessing-phenocam-data",
    "title": "\n                Explore PhenoCam Data\n            ",
    "section": "Accessing PhenoCam Data",
    "text": "Accessing PhenoCam Data\nWe’ll be using the phenocamapi R package to directly download PhenoCam data. An API is an application programming interface (API), which is a way for two or more applications/computers to talk with one another. In this case, it allows us to directly access data from the PhenoCam database.\nThen, you’ll choose a site to view some images and download greenness data. Finally, you’ll create a gif (short movie) of your site through time.\nFirst, we need to open the required packages. A package is a collection of functions/tools to complete a desired task. For example, you need a certain set of tools to build a birdhouse, but a different set of tools to bake a cake. In this case, the phenocamapi and phenocamr packages have the tools to interact with and download phenocam data. The other packages listed below assist with visualization and formatting.\n\nlibrary(phenocamapi)\nlibrary(phenocamr)\nlibrary(jpeg)\nlibrary(purrr) \nlibrary(magick)\nlibrary(lubridate)\nlibrary(ggplot2)\nlibrary(pals)\nlibrary(maps)\nlibrary(plotly)\n\nNext, indicate a location (file path) where you want the PhenoCam images to save. For this workshop, we’ll create a new file within GitHub Codespaces called pheno_images.\n\n\n\n\n\n\nTip\n\n\n\nIn the future, if you’re using R Studio locally on your computer, you can enter the path to a local directory, or folder, on your computer instead (e.g., “/Users/username/Desktop/pheno_images”). Make sure to use the forward slash (/) to separate folder names. Notice that we use the file.path() function, which produces the correct path no matter what setup you are using.\n\n\n\n# Designate directory (file path)\ndir = file.path('.', 'pheno_images')\n\n# Create test_images folder\ndir.create(dir)\n\n# View directory\ndir\n\n[1] \"./pheno_images\"\n\n\nFirst, we’ll download a table to see all the available PhenoCam sites and associated metadata. For example, each entry lists a site’s geographic coordinates, date of first and last image, primary vegetation type (see table below for abbreviations), and mean annual temperature and precipitation, among other things.\nVegetation types:\n\n\n\nAbbreviation\nVegetation Type\n\n\n\n\nAG\nAgriculture\n\n\nDB\nDeciduous Broadleaf\n\n\nEB\nEvergreen Broadleaf\n\n\nEN\nEvergreen Needleleaf\n\n\nDN\nDeciduous Needleleaf\n\n\nGR\nGrassland\n\n\nMX\nMixed Forest\n\n\nNV\nNon-vegetated\n\n\nSH\nShrub\n\n\nTN\nTundra\n\n\nUN\nUnderstory\n\n\nWL\nWetland\n\n\n\n\n# List metadata of all sites\nsitelist_table &lt;- get_phenos() \n\n\n\n\n\n\nsite\nlat\nlon\nelev\nactive\nutc_offset\ndate_first\ndate_last\ninfrared\ncontact1\ncontact2\nsite_description\nsite_type\ngroup\ncamera_description\ncamera_orientation\nflux_data\nflux_networks\nflux_sitenames\ndominant_species\nprimary_veg_type\nsecondary_veg_type\nsite_meteorology\nMAT_site\nMAP_site\nMAT_daymet\nMAP_daymet\nMAT_worldclim\nMAP_worldclim\nkoeppen_geiger\necoregion\nlandcover_igbp\ndataset_version1\nsite_acknowledgements\nmodified\nflux_networks_name\nflux_networks_url\nflux_networks_description\n\n\n\n\naafcottawacfiaf14e\n45.29210\n-75.76640\n90\nTRUE\n-5\n2020-04-27\n2024-09-27\nN\nElizabeth Pattey &lt;elizabeth.pattey@canada.ca&gt;\nLuc Pelletier &lt;luc.pelletier3@canada.ca&gt;\nAAFC Site - Ottawa (On) - CFIA - Field F14 - East Flux Tower\nII\nNA\nCampbell Scientific CCFC\nNE\nTRUE\nNULL\nNA\nZea mays, Triticum aestivum, Brassica napus, Glycine max\nAG\nAG\nTRUE\n6.4\n943\n6.30\n952\n6.0\n863\nDfb\n8\n12\nNA\nCamera funded by Agriculture and Agri-Food Canada (AAFC) Project J-001735 - Commercial inhibitors’ impact on crop productivity and emissions of nitrous oxide led by Dr. Elizabeth Pattey; Support provided by Drs, Luc Pelletier and Elizabeth  Pattey, Micrometeorologiccal Laboratory of AAFC - Ottawa Research and Development Centre.\n2021-08-23T12:12:59.295391-04:00\nNA\nNA\nNA\n\n\naafcottawacfiaf14n\n45.29290\n-75.76700\n90\nTRUE\n-5\n2021-09-03\n2024-09-19\nY\nElizabeth Pattey &lt;elizabeth.pattey@agr.gc.ca&gt;\nLuc Pelletier &lt;luc.pelletier3@agr.gc.ca&gt;\nAAFC Site - Ottawa (On) - CFIA - Field F14 - North Section\nI\nNA\nStarDot NetCam SC\nNNW\nTRUE\nNULL\n\nZea mays, Triticum aestivum, Brassica napus, Glycine max\nAG\nAG\nTRUE\n6.4\n943\n6.30\n953\n5.9\n863\nDfb\n8\n12\nNA\nCameras funded by Agriculture and Agri-Food Canada (AAFC) Project J-001735 - Commercial inhibitors’ impact on crop productivity and emissions of nitrous oxide led by Dr. Elizabeth Pattey; Support provided by Drs, Luc Pelletier and Elizabeth Pattey, Micrometeorologiccal Laboratory of AAFC - Ottawa Research and Development Centre.\n2021-08-13T10:49:30.502306-04:00\nNA\nNA\nNA\n\n\naafcottawacfiaf14w\n45.29210\n-75.76640\n90\nTRUE\n-5\n2020-05-01\n2024-10-11\nN\nElizabeth Pattey &lt;elizabeth.pattey@canada.ca&gt;\nLuc Pelletier &lt;luc.pelletier3@canada.ca&gt;\nAAFC Site - Ottawa (On) - CFIA - Field F14 - West Flux Tower\nII\nNA\nCampbell Scientific CCFC\nWNW\nTRUE\nOTHER , , Other/Unaffiliated\nNA\nZea mays, Triticum aestivum, Brassica napus, Glycine max\nAG\nAG\nTRUE\n6.4\n943\n6.30\n952\n6.0\n863\nDfb\n8\n12\nNA\nCameras funded by Agriculture and Agri-Food Canada (AAFC) Project J-001735 - Commercial inhibitors’ impact on crop productivity and emissions of nitrous oxide led by Dr. Elizabeth Pattey; Support provided by Drs, Luc Pelletier and Elizabeth  Pattey, Micrometeorologiccal Laboratory of AAFC - Ottawa Research and Development Centre.\n2021-08-23T12:13:11.193254-04:00\nOTHER\n\nOther/Unaffiliated\n\n\nacadia\n44.37694\n-68.26083\n158\nFALSE\n-5\n2007-03-15\n2022-01-07\nN\nDee Morse &lt;dee_morse@nps.gov&gt;\nJohn Gross &lt;John_Gross@nps.gov&gt;\nAcadia National Park, McFarland Hill, near Bar Harbor, Maine\nIII\nNational Park Service\nunknown\nNE\nFALSE\nNULL\n\n\nDB\nEN\nFALSE\nNA\nNA\n7.05\n1439\n6.5\n1303\nDfb\n8\n5\nNA\nCamera images from Acadia National Park are provided courtesy of the National Park Service Air Resources Program.\n2016-11-01T15:42:15.016778-04:00\nNA\nNA\nNA\n\n\nadmixpasture\n-43.64930\n172.34950\n33\nFALSE\n12\n2021-03-04\n2022-09-08\nY\nJohn Hunt &lt;huntj@landcareresearch.co.nz&gt;\nScott Graham &lt;grahams@landcareresearch.co.nz&gt;\nEddy site, mixed species irrigated dairy pasture, Ashley Dene Research & Development Station, South Island, New Zealand\nI\nNA\nStarDot NetCam SC\n\nTRUE\nNULL\nNZ-ADw\nLolium perenne, Lolium multiflorum, Trifolium pratense, Trifolium repens, Plantago lanceolata\nAG\n\nTRUE\nNA\nNA\nNA\nNA\n11.6\n640\nCfb\nNA\nNA\nNA\nMinistry of Business, Innovation and Employment; New Zealand Agricultural Greenhouse Gas Research Centre; Manaaki Whenua\n2021-03-09T17:03:10.816039-05:00\nNA\nNA\nNA\n\n\nadrycpasture\n-43.65130\n172.35010\n31\nFALSE\n12\n2021-03-02\n2022-09-08\nY\nJohn Hunt &lt;huntj@landcareresearch.co.nz&gt;\nScott Graham &lt;grahams@landcareresearch.co.nz&gt;\nRyegrass-clover irrigated dairy pasture, Ashley Dene Research & Development Station, South Island, New Zealand\nI\nNA\nStarDot NetCamSC\n\nTRUE\nNULL\n\nLolium perenne, Trifolium repens\nAG\n\nTRUE\nNA\nNA\nNA\nNA\n11.6\n639\nCfb\nNA\nNA\nNA\nMinistry of Business, Innovation and Employment; New Zealand Agricultural Greenhouse Gas Research Centre; Manaaki Whenua\n2021-03-09T17:03:11.773814-05:00\nNA\nNA\nNA\n\n\n\n\n\n\n\nYou can filter the table by any of the available attributes (column names). For example, I created a subset of only grasslands (GR) sites below.\n\n# Create a subset of only grassland sites \nGR_sites &lt;- subset(sitelist_table, primary_veg_type == \"GR\")  \n\n\n\n\n\n\nsite\nlat\nlon\nelev\nactive\nutc_offset\ndate_first\ndate_last\ninfrared\ncontact1\ncontact2\nsite_description\nsite_type\ngroup\ncamera_description\ncamera_orientation\nflux_data\nflux_networks\nflux_sitenames\ndominant_species\nprimary_veg_type\nsecondary_veg_type\nsite_meteorology\nMAT_site\nMAP_site\nMAT_daymet\nMAP_daymet\nMAT_worldclim\nMAP_worldclim\nkoeppen_geiger\necoregion\nlandcover_igbp\ndataset_version1\nsite_acknowledgements\nmodified\nflux_networks_name\nflux_networks_url\nflux_networks_description\n\n\n\n\narchboldbahia\n27.16560\n-81.21611\n8\nTRUE\n-5\n2017-03-21\n2024-10-13\nY\nAmartya Saha &lt;asaha@archbold-station.org&gt;\nElizabeth Boughton &lt;eboughton@archbold-station.org&gt;\nArchbold Biological Station, Florida, USA\nI\nLTAR\nStarDot NetCam SC\nN\nFALSE\nNULL\nNA\n\nGR\nNA\nFALSE\nNA\nNA\n22.85\n1302\n22.5\n1208\nCfa\n8\n14\nNA\nThis research was a contribution from the Long-Term Agroecosystem Research (LTAR) network. LTAR is supported by the United States Department of Agriculture.\n2022-10-19T13:24:12.256706-04:00\nNA\nNA\nNA\n\n\narsgacp2\n31.43950\n-83.59146\n101\nFALSE\n2\n2016-04-27\n2018-01-23\nY\nDavid Bosch &lt;David.Bosch@ars.usda.gov&gt;\n\nSoutheast Watershed Research Laboratory EC2 Tifton, Georgia\nI\nLTAR\nNA\nNA\nFALSE\nNULL\nNA\n\nGR\nNA\nFALSE\nNA\nNA\n19.00\n1251\n18.7\n1213\nCfa\n8\n14\nNA\nThis research was a contribution from the Long-Term Agroecosystem Research (LTAR) network. LTAR is supported by the United States Department of Agriculture.\n2022-10-19T13:26:15.042047-04:00\nNA\nNA\nNA\n\n\nbitterbrush001\n48.15400\n-119.94560\n667\nTRUE\n-8\n2020-09-20\n2024-08-31\nY\nBrandon Sackmann &lt;bssackmann@gsi-net.com&gt;\nBrandon Sackmann &lt;bssackmann@gsienv.com&gt;\nParcel 1 East at Midpoint (Shrub-Steppe - Post Wildfire ca. 2014), Methow, Washington\nI\nNA\nStarDot NetCam SC\nW\nFALSE\nNULL\n\n\nGR\nSH\nFALSE\n8.7\n323\n8.35\n420\n7.3\n340\nDsb\n10\n1\nNA\nResearch at this site is supported by GSI Environmental Inc. (http://www.gsi-net.com), Olympia, WA.\n2020-10-30T10:48:53.990761-04:00\nNA\nNA\nNA\n\n\nblueoakheadquarters\n37.38270\n-121.73930\n572\nTRUE\n-8\n2022-01-24\n2024-10-13\nY\nZachariah Tuhtill &lt;ztuthill@berkeley.edu&gt;\nZachary Harlow &lt;harlow@berkeley.edu&gt;\nResidence Meadow, Blue Oak Ranch Reserve, Santa Clara County, CA\nI\nNA\nStarDot NetCam SC\nN\nFALSE\nNULL\n\nAvena spp., Quercus lobata, Elymus trachycaulus\nGR\nDB\nFALSE\n13.4\n600\n14.35\n501\n14.3\n646\nCsb\n11\n8\nNA\nBlue Oak Ranch Reserve is part of the University of California Natural Reserve System. Blue Oak Ranch is administered bu the University of California, Berkeley\n2021-04-12T09:54:24.431967-04:00\nNA\nNA\nNA\n\n\nbozeman\n45.78306\n-110.77778\n2332\nFALSE\n-7\n2015-08-16\n2019-12-18\nY\nPaul Stoy &lt;paul.stoy@gmail.com&gt;\n\nBangtail Study Area, Montana State University, Montana\nI\nAmericaView AMERIFLUX\nStarDot NetCam SC\nN\nTRUE\nAMERIFLUX , http://ameriflux.lbl.gov, AmeriFlux Network\nUS-MTB (forthcoming)\nFestuca idahoensis\nGR\nEN\nFALSE\n5.0\n850\n2.30\n981\n0.9\n728\nDfb\n6\n10\nNA\nResearch at the Bozeman site is supported by Colorado State University and the AmericaView program (grants G13AC00393, G11AC20461, G15AC00056) with phenocam equipment and deployment sponsored by the Department of Interior North Central Climate Science Center.\n2016-11-01T15:42:19.771057-04:00\nAMERIFLUX\nhttp://ameriflux.lbl.gov\nAmeriFlux Network\n\n\nbutte\n45.95304\n-112.47964\n1682\nTRUE\n-7\n2008-04-01\n2024-10-13\nN\nJames Gallagher &lt;jgallagher@opendap.org&gt;\nMartha Apple &lt;MApple@mtech.edu&gt;\nContinental Divide, Butte, Montana\nI\nPhenoCam\nStarDot NetCam SC\nE\nFALSE\nNULL\n\nAgropyron cristatum, Poa pratensis, Phalaris arundinaceae, Carex. sp., Geum triflorum, Ericameria nauseousa, Centaurea macula, Achillea millefolium, Senecio sp., Lupinus sp., Penstemon sp., Linaria vulgaris, Cirsium arvense; Alnus incana, Salix sp., Populus tremuloides\nGR\nSH\nFALSE\nNA\nNA\n5.05\n365\n4.3\n311\nBSk\n6\n10\nNA\nResearch at the Continental Divide PhenoCam Site in Butte, Montana is supported by the National Science Foundation-EPSCoR (grant NSF-0701906), OpenDap, Inc., and Montana Tech of the University of Montana\n2016-11-01T15:42:19.846100-04:00\nNA\nNA\nNA\n\n\n\n\n\n\n\n\n\n\n\n\n\nChallenge\n\n\n\nCan you subset the sitelist_table by a different primary vegetation type? How about by a different variable (table column)? Use the code cell below.",
    "crumbs": [
      "MEFA Phenocam Workshop",
      "Explore PhenoCam Data"
    ]
  },
  {
    "objectID": "notebooks/07-phenocam/phenocam.html#create-a-map-of-the-phenocam-sites",
    "href": "notebooks/07-phenocam/phenocam.html#create-a-map-of-the-phenocam-sites",
    "title": "\n                Explore PhenoCam Data\n            ",
    "section": "Create a Map of the PhenoCam Sites",
    "text": "Create a Map of the PhenoCam Sites\nNow, we’ll create an interactive map to view all the PhenoCam sites colored by their primary vegetation type. First, using our sitelist_table that we downloaded above, we filter out any sites for which a primary vegetation type isn’t listed or an “NA” is entered. We’ll call this new data table “sitelist_table2”.\n\n# Remove sites with NA and empty cells for primary_veg_type\nsitelist_table2 &lt;- sitelist_table[\n    !(is.na(sitelist_table$primary_veg_typ) | \n    sitelist_table$primary_veg_typ==\"\"), \n]\n\nThen, we’ll create a static map of the PhenoCam sites using their latitude and longitude (included in “sitelist_table2”). We’ll overlay this onto a basemap of the world and US states.\n\n# Download basemaps of the world and US states\nworld_map &lt;- map_data(\"world\")\nstate_map &lt;- map_data(\"state\")\n\n## Create map of sites\nSite_map &lt;- ggplot() +\n    # Add world map  \n    geom_polygon(data = world_map, aes(x = long, y = lat, group = group), \n                fill = \"white\", color = \"black\") +\n    # Add state map\n    geom_polygon(data = state_map, aes(x = long, y = lat, group = group), \n                fill = NA, color = \"black\") +  \n    # Add PhenoCam sites as points\n    geom_point(data = sitelist_table2, aes(x = lon, y = lat,\n                color = primary_veg_type,\n                text = paste(\"Site:\", site)), size = 3) +\n    # Choose legend colors  \n    scale_color_manual(values=as.vector(trubetskoy(11))) + \n    # Add title and labels  \n    labs(title = \"PhenoCam Sites by Vegetation Type\", x = \"Longitude\", \n        y = \"Latitude\", color = \"Primary Veg Type\") +\n    # Indicate map theme (general appearance)\n    theme_minimal() +\n    # Center title and increase font size\n    theme(plot.title = element_text(hjust = 0.5, size = 20))\n  \n# View map\nSite_map\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nChallenge\n\n\n\nCan you change the title of the map? Make the change and re-run the code cell above.\n\n\nLet’s make the map interactive! You can hover over sites to see their details, draw a box around a specific area to zoom into the region, and click on various legend entries to toggle them on or off. Double click on the map to zoom back out.\n\n# Make map interactive\nggplotly(Site_map)\n\n\n\n\n\n\nDownload & Plot Canopy Greenness\nNow, let’s view some PhenoCam images and greenness data. Choose a site to explore, and enter the site name and relevant information in the cell below. For example, I chose the site “lacclair”, which represents a deciduous broadleaf (“DB”) vegetation type, and I chose to look at images from the year 2022. You’ll also need to specify which region of interest (ROI) to use for your site. Recall that some sites have multiple ROIs, each with a unique ID number. You can view the possible ROIs for your site on the PhenoCam website.\n\n# Choose site to explore \n# Enter name exactly as it appears in the table/on the website\nsite_name = \"lacclair\"\n\n# Indicate vegetation type (listed on site page)\nveg = \"DB\"\n\n# Choose data year (for downloading images later)\nyear = 2022\n\n# Indicate ROI ID\nROI = 1000\n\n# View the objects to make sure correct\nsite_name\n\n[1] \"lacclair\"\n\nveg\n\n[1] \"DB\"\n\nyear\n\n[1] 2022\n\nROI\n\n[1] 1000\n\n\nFirst, we’ll download canopy greenness (GCC = green chromatic coordinate) timeseries data for your chosen site. The GCC data are already condensed down to 1-day and 3-day data products (type = ‘3day’ or ‘1day’). See (Richardson et al. (2018)) for more information about PhenoCam data processing.\n\n# Download GCC timeseries\nGCC_timeseries &lt;- get_pheno_ts(\n    site = site_name,\n    vegType = veg,\n    roiID = ROI,\n    type = \"3day\"\n)\n\n\n\n\n\n\ndate\nyear\ndoy\nimage_count\nmidday_filename\nmidday_r\nmidday_g\nmidday_b\nmidday_gcc\nmidday_rcc\nr_mean\nr_std\ng_mean\ng_std\nb_mean\nb_std\ngcc_mean\ngcc_std\ngcc_50\ngcc_75\ngcc_90\nrcc_mean\nrcc_std\nrcc_50\nrcc_75\nrcc_90\nmax_solar_elev\nsnow_flag\noutlierflag_gcc_mean\noutlierflag_gcc_50\noutlierflag_gcc_75\noutlierflag_gcc_90\nYEAR\nDOY\nYYYYMMDD\n\n\n\n\n2014-08-24\n2014\n236\n48\nlacclair_2014_08_24_120005.jpg\n112.4952\n107.31002\n64.79199\n0.37706\n0.39528\n101.2134\n10.45700\n97.89047\n7.24635\n60.17627\n3.34001\n0.37778\n0.00470\n0.37674\n0.37769\n0.38626\n0.38951\n0.01273\n0.39466\n0.39571\n0.39645\n54.28096\nNA\nNA\nNA\nNA\nNA\n2014\n236\n2014-08-24\n\n\n2014-08-27\n2014\n239\n11\nlacclair_2014_08_27_100006.jpg\n102.9682\n99.27311\n58.65611\n0.38051\n0.39467\n99.8069\n7.75972\n96.45416\n5.20932\n57.23162\n3.03065\n0.38071\n0.00416\n0.37808\n0.38492\n0.38687\n0.39336\n0.00810\n0.39596\n0.40017\n0.40124\n53.23820\nNA\nNA\nNA\nNA\nNA\n2014\n239\n2014-08-27\n\n\n2014-08-30\n2014\n242\n12\nlacclair_2014_08_29_140006.jpg\n101.5794\n96.23061\n61.00618\n0.37181\n0.39248\n105.6391\n3.39082\n99.59658\n3.11701\n61.88915\n1.38803\n0.37282\n0.00109\n0.37296\n0.37386\n0.37391\n0.39544\n0.00168\n0.39603\n0.39664\n0.39692\n52.16943\nNA\nNA\nNA\nNA\nNA\n2014\n242\n2014-08-30\n\n\n2014-09-02\n2014\n245\n0\nNone\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n2014\n245\n2014-09-02\n\n\n2014-09-05\n2014\n248\n0\nNone\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n2014\n248\n2014-09-05\n\n\n2014-09-08\n2014\n251\n34\nlacclair_2014_09_08_120005.jpg\n107.3645\n100.17020\n62.23183\n0.37132\n0.39799\n100.3327\n8.52167\n94.27381\n6.62527\n58.44414\n4.80790\n0.37275\n0.00428\n0.37085\n0.37625\n0.37959\n0.39626\n0.00779\n0.39837\n0.40123\n0.40235\n48.48855\nNA\nNA\nNA\nNA\nNA\n2014\n251\n2014-09-08\n\n\n\n\n\n\n\nNow, we’ll plot the GCC timeseries to see how canopy greenness changes over time at your chosen site. From the “GCC_timeseries” table, we’ll plot the variable called “gcc_90”, which corresponds to the 90th percentile of GCC values across the 3-day window within the designated ROI. Using the 90th percentile (rather than the mean) reduces the influence of changing weather and brightness across the images. See Richardson et al. (2018) for more details on data products and processing.\n\n# Put date into date format\nGCC_timeseries[, date := as.Date(date)]\n\n# Create line plot\nplot(\n    GCC_timeseries$date, GCC_timeseries$gcc_90,\n    # Choose line color & type\n    col = \"darkgreen\", type = \"b\",\n    # Add axis labels\n    xlab = \"Date\", ylab = \"GCC\",\n    # Add title\n    main = paste0(site_name, \": Canopy Greenness Timeseries\")\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSaving plots\n\n\n\nSince this plot isn’t saved as an object, it only appears in the built-in plot viewer for R. However, you can right click on the plot to copy and paste it elsewhere. If you accidentally close a plot and want to see it again, you can re-run the code cell that created it.",
    "crumbs": [
      "MEFA Phenocam Workshop",
      "Explore PhenoCam Data"
    ]
  },
  {
    "objectID": "notebooks/07-phenocam/phenocam.html#explore-seasonal-transition-dates",
    "href": "notebooks/07-phenocam/phenocam.html#explore-seasonal-transition-dates",
    "title": "\n                Explore PhenoCam Data\n            ",
    "section": "Explore Seasonal Transition Dates",
    "text": "Explore Seasonal Transition Dates\nWe can also download and plot the 50% seasonal transition dates (spring green-up and fall brown-down) for your site. We’ll use another package called phenocamr to download the transition dates.\n\n# Download csv files of (1) GCC timeseries and (2) transition dates\n# They will save in your designated directory (dir)\ndownload_phenocam(\n    site = site_name,\n    veg_type = veg,\n    frequency = 3,\n    phenophase = TRUE,\n    out_dir = dir\n)\n\n# Read in the transition date csv file:\n\n# Designate file location\ntrans_dates_path &lt;- file.path(\n    dir,\n    paste0(\n        site_name, \"_\", veg, \"_\", ROI,\n        \"_3day_transition_dates.csv\"\n    )\n)\n\n# Read in file\ntrans_dates &lt;- read.table(trans_dates_path,\n    header = TRUE,\n    sep = \",\"\n)\n\n\n\n\n\n\nsite\nveg_type\nroi_id\ndirection\ngcc_value\ntransition_10\ntransition_25\ntransition_50\ntransition_10_lower_ci\ntransition_25_lower_ci\ntransition_50_lower_ci\ntransition_10_upper_ci\ntransition_25_upper_ci\ntransition_50_upper_ci\nthreshold_10\nthreshold_25\nthreshold_50\nmin_gcc\nmax_gcc\n\n\n\n\nlacclair\nDB\n1000\nrising\ngcc_90\n2015-05-08\n2015-05-13\n2015-05-19\n2015-05-06\n2015-05-12\n2015-05-17\n2015-05-11\n2015-05-14\n2015-05-20\n0.32106\n0.33873\n0.37776\n0.31121\n0.42854\n\n\nlacclair\nDB\n1000\nrising\ngcc_90\n2016-05-16\n2016-05-18\n2016-05-23\n2016-05-15\n2016-05-17\n2016-05-21\n2016-05-17\n2016-05-20\n2016-05-24\n0.32499\n0.33779\n0.37759\n0.31397\n0.43286\n\n\nlacclair\nDB\n1000\nrising\ngcc_90\n2017-05-13\n2017-05-17\n2017-05-23\n2017-05-11\n2017-05-16\n2017-05-21\n2017-05-15\n2017-05-19\n2017-05-24\n0.32248\n0.33651\n0.37307\n0.31225\n0.42586\n\n\nlacclair\nDB\n1000\nrising\ngcc_90\n2018-05-15\n2018-05-19\n2018-05-23\n2018-05-14\n2018-05-18\n2018-05-22\n2018-05-17\n2018-05-20\n2018-05-24\n0.32232\n0.34202\n0.37272\n0.31391\n0.42873\n\n\nlacclair\nDB\n1000\nrising\ngcc_90\n2019-05-19\n2019-05-23\n2019-05-30\n2019-05-18\n2019-05-22\n2019-05-28\n2019-05-22\n2019-05-25\n2019-05-31\n0.32253\n0.33885\n0.37437\n0.31322\n0.43380\n\n\nlacclair\nDB\n1000\nrising\ngcc_90\n2020-05-18\n2020-05-20\n2020-05-24\n2020-05-16\n2020-05-19\n2020-05-23\n2020-05-19\n2020-05-22\n2020-05-25\n0.32535\n0.33622\n0.37202\n0.31390\n0.42874\n\n\n\n\n\n\n\nNow we’ll plot the transition dates on the GCC timeseries.\n\n# Pull out transition dates from the trans_dates table\n\n# Select the rising (spring dates) for 50% threshold of Gcc 90\ntd_rise &lt;- trans_dates[\n    trans_dates$direction == \"rising\" & trans_dates$gcc_value == \"gcc_90\", \n]\n\n# Select the falling (fall dates) for 50% threshold of Gcc 90\ntd_fall &lt;- trans_dates[\n    trans_dates$direction == \"falling\" & trans_dates$gcc_value == \"gcc_90\", \n]\n\n# As above, create a simple line graph of the Green Chromatic Coordinate (GCC)\n\n# Plot- this time use \"type = 1\" to create a smooth line graph\nplot(GCC_timeseries$date, GCC_timeseries$gcc_90,\n    col = \"black\", type = \"l\",\n    xlab = \"Date\", ylab = \"GCC\",\n    main = paste0(site_name, \": \", \"Seasonal Transition Dates\")\n)\n\n\n# Add points to show transition dates:\n\n# Spring green-up\npoints(\n    x = as.Date(td_rise$transition_50, origin = \"1970-01-01\"),\n    y = td_rise$threshold_50,\n    pch = 19,\n    col = \"green\"\n)\n\n# Fall brown-down\npoints(\n    x = as.Date(td_fall$transition_50, origin = \"1970-01-01\"),\n    y = td_fall$threshold_50,\n    pch = 19,\n    col = \"brown\"\n)\n\n\n\n\n\n\n\n\nNow, let’s explore the variability of seasonal transition dates throughout the available data years. This works best if you chose a site with a longer timeseries. We’ll first convert the transition dates into a “day-of-year” (DOY) format (e.g., Jan 1 = DOY 1, Jan 2 = DOY 2, etc.), and then plot those by year.\n\n# Convert green-up dates to date format and then DOY\ntd_spring_dates &lt;- as.Date(td_rise$transition_50,format='%Y-%m-%d')\ntd_spring_DOY &lt;- lubridate::yday(td_spring_dates)\n\n# Convert brown-down dates to date format and then DOY\ntd_fall_dates &lt;- as.Date(td_fall$transition_50,format='%Y-%m-%d')\ntd_fall_DOY &lt;- lubridate::yday(td_fall_dates)\n\n# Extract spring data years\nyears_spr &lt;- as.numeric(format(td_spring_dates,'%Y'))\n\n# Create table of years and spring transition dates\ntrans_table_spring &lt;- data.frame(years_spr, td_spring_DOY)\n\n# Plot spring green-up dates\nplot(trans_table_spring[,1],trans_table_spring[,2], \n    type = \"b\", col = \"darkgreen\",\n    xlab = 'Year', ylab = 'Spring Transition Date (DOY)',\n    main = paste0(site_name, ': ', 'Date of Spring Onset Through the Years'))\n\n\n\n\n\n\n\n\nAnd now plot the fall brown-down transition dates.\n\n# Extract fall data years\nyears_fall &lt;- as.numeric(format(td_fall_dates,'%Y'))\n\n# Create table of years and fall transition dates\ntrans_table_fall &lt;- data.frame(years_fall, td_fall_DOY)\n\n# Plot fall brown-down dates\nplot(trans_table_fall[,1], trans_table_fall[,2], \n     type = \"b\", col = \"brown\",\n     xlab = 'Year', ylab = 'Autumn Transition Date (DOY)',\n     main = paste0(site_name, ': ', 'Date of Autumn Onset Through the Years'))\n\n\n\n\n\n\n\n\nAs you can see, there is a decent amount of year-to-year variability in when a site greens up (spring) or browns down (fall), directly impacting the total length of the growing sesason. This variability is largely due to differences in weather, such as precipitation and temperature. Climate change is also shifting seasonal transition dates, which can impact many other variables, such as plant-animal interactions and ecosystem carbon and water storage.\n\nDownload PhenoCam Images\nNext, we’ll download some photos from your chosen site. Images are typically taken every 30 minutes, but for simplicity, we’ll just download 1 image per month in order to visualize phenology changes. This code downloads the midday (~12 pm) image for the 15th day (“days = 15”) of each month (“months = 1:12”) for the year you chose above. The images will appear in the folder you designated above (dir).\n\n# Download PhenoCam images\ndownload_midday_images(\n    site = site_name,\n    y = year,\n    months = 1:12,\n    days = 15,\n    download_dir = dir\n)\n\nNow, we’ll use those images to create a photo collage that displays changes in phenology throughout the year. First, we’ll set it up and check that it’s working correctly. You should have 12 images (1 per month), so when you run the code below, “n” should equal 12. If not, look in your “dir” (pheno_images) folder and make sure it only includes images for a single PhenoCam site. If you have more than 12, right click on the images you don’t want and delete them from the folder.\n\n# Isolate images from your designated directory\n# Pics are jpeg format\nmiddays_path &lt;- dir(dir, pattern = \"*.jpg\", full.names = TRUE)\n\n# See a sample of image directory paths to make sure it worked\nhead(middays_path)\n\n[1] \"./pheno_images/lacclair_2022_01_15_120011.jpg\"\n[2] \"./pheno_images/lacclair_2022_02_15_120010.jpg\"\n[3] \"./pheno_images/lacclair_2022_03_15_120007.jpg\"\n[4] \"./pheno_images/lacclair_2022_04_15_120008.jpg\"\n[5] \"./pheno_images/lacclair_2022_05_15_120005.jpg\"\n[6] \"./pheno_images/lacclair_2022_06_15_120006.jpg\"\n\n# Determine number of images (should be 12, 1 per month)\nn &lt;- length(middays_path)\nn\n\n[1] 12\n\n\nThen we’ll create the layout.\n\n# Set up image layout (4 rows & 3 columns)\npar(\n    mar = c(0, 0, 0, 0),\n    mfrow = c(4, 3)\n)\n\n# Create monthly image layout with labels (this can take 1-2 min)\nfor (i in 1:n) {\n    img &lt;- jpeg::readJPEG(middays_path[i])\n    plot(0:1, 0:1, type = \"n\", axes = FALSE, xlab = \"\", ylab = \"\")\n    rasterImage(img, 0, 0, 1, 1)\n    mtext(month.name[i], line = -2)\n}\n\n# Add title (feel free to edit the title below)\nmtext(\n    paste0(site_name, \": \", \"Canopy Greenness Through the Months\"),\n    outer = TRUE\n)\n\n\n\n\n\n\n\n\nFinally, we’ll use those same images to create a gif that shows changes in phenology over time. This is great to use in presentations to visualize seasonal transitions!\n\n# Make timelapse gif of images\ngif &lt;- list.files(path = dir, pattern = \"*.jpg\", full.names = T) %&gt;% \n\n  purrr::map(image_read) %&gt;% \n  \n  image_join() %&gt;% \n  \n  # Add text to each image -  you can change the size, location, color below\n  image_annotate(paste(site_name,\"Jan-Dec\", year), \n                 location = \"+900+30\", \n                 size = 35, \n                 color = \"black\") %&gt;%\n  \n  # Frames per second (higher number = faster, lower number = slower)\n  image_animate(fps=0.5) %&gt;%\n  \n  # Designate file name & save to your directory\n  image_write(file.path(dir, \"MonthlyGreenness_gif.gif\")) \n\n# The gif will be saved to the directory you indicated at the beginning \n# You can check the directory path below\ndir\n\n[1] \"./pheno_images\"\n\n\nAs an example, here’s the gif I made for the lacclair site. Your gif will be saved to the directory you indicated at the beginning (dir). If you want to save it, right click on the gif file name and select “download”.\n\n\n\nMonthly Greenness\n\n\n\n\nExplore another site!\nNow try this exercise with another PhenoCam site. Perhaps choose a different ecosystem type. Think about how seasonal greenness patterns differ between sites. What do you think causes these differences?\nTo do this, edit the cell near the beginning where you assign the site name, vegetation type, year, and ROI (in the “Download & Plot Canopy Greenness” section). Be sure to re-run that cell and all cells below it in sequential order.\nBut before trying a new site, run this code cell to re-set your plotting parameters and delete all the downloaded files in your “pheno_images” (dir) folder. Be sure to download your gif first if you want to save a copy.\n\n# Reset plotting parameters\ndev.off()\n\n# List all files in \"pheno_images\"\nf &lt;- list.files(dir, include.dirs = F, full.names = T, recursive = T)\n\n# Remove the files\nfile.remove(f)\n\n\nThank you\nThanks for exploring PhenoCam data. Hopefully, you have a stronger appreciation for phenology now!",
    "crumbs": [
      "MEFA Phenocam Workshop",
      "Explore PhenoCam Data"
    ]
  }
]