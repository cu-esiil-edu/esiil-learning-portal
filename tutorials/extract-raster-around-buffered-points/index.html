


<!doctype html>
<html lang="en" class="no-js">
  <head>
    


<meta charset="utf-8">




<!-- begin SEO -->









<title>Computing raster statistics around buffered spatial points Python | Earth Data Science - Earth Lab </title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="Earth Data Science - Earth Lab">
<meta property="og:title" content="Computing raster statistics around buffered spatial points Python">


  <link rel="canonical" href="https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/">
  <meta property="og:url" content="https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/">



  <meta content="This tutorial shows how to compute raster statistics like the mean and variance around buffered spatial points in Python." name="description">
  <meta property="og:description" content="This tutorial shows how to compute raster statistics like the mean and variance around buffered spatial points in Python.">


<!-- twitter cards -->

  <meta name="twitter:site" content="@earthlabcu">
  <meta name="twitter:title" content="Computing raster statistics around buffered spatial points Python">
  <meta name="twitter:description" content="This tutorial shows how to compute raster statistics like the mean and variance around buffered spatial points in Python.">
  <meta name="twitter:url" content="https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/">

  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://earthdatascience.org/images/earth_sm_twit.png">
    <meta name="twitter:image:alt" content="The Earthlab Logo - image of a globe with courses, lessons and tutorials">

    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-07-15T00:00:00-05:00">
  
    <link rel="next" href="https://earthdatascience.org/tutorials/intro-to-spatial-regression/" title="DEPRECATED: Introduction to spatial regression in Python">
  
  
    <link rel="prev" href="https://earthdatascience.org/tutorials/acquire-and-visualize-usgs-hydrology-data/" title="Acquiring streamflow data from USGS with climata and Python">
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Earth Analytics",
      "url" : "https://earthdatascience.org",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://earthdatascience.org/feed.xml" type="application/atom+xml" rel="alternate" title="Earth Data Science - Earth Lab Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="LfpevjsE0wlELv5KKOZv1T2RhRimGSiRckWv5ZC19GU" />
<!-- don't use the old cataloged meta tags -->
<meta name="googlebot" content="noodp">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>


<!-- For all browsers
<link rel="stylesheet" href="https://earthdatascience.org/assets/css/main.css">-->
<link rel="stylesheet" href="https://earthdatascience.org/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->


    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>

    <script src="https://earthdatascience.org/assets/js/copy-code.js"></script>
  </head>

  <body>


    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<!-- search bar begin  - turning off for now-->

<div class="search">
<form role="search" method="get" action="https://earthdatascience.org/search/">
    <input id="q" name="q"
           placeholder="Search earth data science site" type="text">
</form>
<!--<span class='cu-boulder'><a href="http://www.colorado.edu/earthlab" target="_blank">Earth Lab University of Colorado - Boulder Home </a></span> -->
</div>


<!-- search bar END -->

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://earthdatascience.org/"><img src="/images/earth-lab-logo.png" alt="Earth Lab - Earth Data Science" style="height:80%;width:85%"></a></li>
          
            
            <li class="masthead__menu-item"><a href="https://earthdatascience.org/tutorials/">Tutorials</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://earthdatascience.org/courses/">Courses</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://earthdatascience.org/workshops/">Workshops</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://earthdatascience.org/tools/">Tools</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://earthdatascience.org/blog/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://earthdatascience.org/about/">About</a></li>
          

        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    



  <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://earthdatascience.org/images/header-images/earth-data-analytics-professional-certificate-banner.jpg');">
  <div class="wrapper">
        <h1 class="page__title" itemprop="headline">
          Earth Data Analytics Online Certificate
        </h1>
        <p><a href="https://earthlab.colorado.edu/earth-data-analytics-professional-graduate-certificate?utm_source=earthdatascience&utm_medium=website&utm_campaign=certificate-2022&utm_id=certificate-2022" target = "_blank" class="btn btn--light-outline btn--large">Enroll now! Learn more.</a></p>
  </div>
</div>





  
    













<nav class="breadcrumbs" role="menubar" aria-label="breadcrumbs">
 <ol itemscope itemtype="http://schema.org/BreadcrumbList">
 <a href="https://earthdatascience.org"></a>
 
 
 <!-- there is an offset of 1 so subtract 2 from the final crumb number-->
 
   
   
     <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
       <a href="https://earthdatascience.org/" itemprop="item"><span itemprop="name">Home</span></a>
       <meta itemprop="position" content="1" />
     </li>
     <span class="sep">/</span>
   
    
        
        <li><a href="https://earthdatascience.org/tutorials/">Tutorials </a>
        <meta itemprop="position" content="2" />
        <span class="sep">/</span></li>
    
  
   
    
        <li class="current">Computing raster statistics around buffered spatial points Python</li>
    
  
</ol>
</nav>

<!-- from min mistakes -->




  


<div id="main" role="main">
  



  <div class="sidebar sticky">
  
  
    
      
      
      
    
    


    

    

    

  
  </div>





<div class="sidebar sticky">
  <nav class="nav__list">
    <ul>
      <li><span class="nav__sub-title">Language</span>
        <ul>
          

          
          <!-- this code counts the number of posts associated with the member -->
          
            
              <li><a href=https://earthdatascience.org/tutorials/python>python (12)</a></li>
            
          

          
          <!-- this code counts the number of posts associated with the member -->
          
            
              <li><a href=https://earthdatascience.org/tutorials/r>r (2)</a></li>
            
          

          
          <!-- this code counts the number of posts associated with the member -->
          
            
              <li><a href=https://earthdatascience.org/tutorials/javascript>javascript (2)</a></li>
            
          
        </ul>
      </li>
    </ul>

<!-- list tutorials by library -->


<!-- end language side bar nav -->

</nav>

</div>


<!-- begin science / science themes side bar nav -->



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">

    <meta itemprop="headline" content="Computing raster statistics around buffered spatial points Python">
    <meta itemprop="description" content="This tutorial shows how to compute raster statistics like the mean and variance around buffered spatial points in Python.">
    <meta itemprop="datePublished" content="July 15, 2016">
    <meta itemprop="dateModified" content="April 20, 2020">

    <div class="page__inner-wrap">
        <header>
          

          <!-- BEGIN: insert a welcome to the module block on pages that are part of a module set -->

          <!-- END: insert welcome block -->

          
              

            
                <h1 class="page__title" itemprop="headline">
                
                 Computing raster statistics around buffered spatial points Python

                
                </h1>
            

          

          
            <div class="page__meta">
              
              
              <a href="https://earthdatascience.org/authors/matt-oakley">Matt Oakley</a>, 
              
              
              <a href="https://earthdatascience.org/authors/max-joseph">Max Joseph</a>
              
            </div>
          

            <br/>

            

              
            

            <!-- For tools pages add authors and tool title -->

            
        </header>



      <section class="page__content" itemprop="text">

        <!-- would like to include the TOC automatically but this does weird things-->
        
          
            <p>One important thing we can do with data in Raster format is calculate statistical values such as mean, standard deviation, variance, etc. around points in the data. By doing so, we’re able to find out attributes about the data and can generalize areas of it as opposed to dealing with every single individual cell.</p>

<h2 id="objectives">Objectives</h2>

<ul>
  <li>Read in a GeoTIFF</li>
  <li>Extract data from the raster at buffered point locations</li>
  <li>Compute statistics from these points</li>
</ul>

<h2 id="dependencies">Dependencies</h2>

<ul>
  <li>GDAL</li>
  <li>NumPy</li>
  <li>GeoPy</li>
  <li>Matplotlib</li>
  <li>elevation</li>
</ul>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">geopy.geocoders</span> <span class="kn">import</span> <span class="n">Nominatim</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">elevation</span>
</code></pre></div></div>

<h2 id="download-and-read-the-data">Download and read the Data</h2>

<p>Our first objective is to read in the data that we want to use. We’ll be working with .tiff image files and reading these in as numpy arrays. By doing so, we’ll be able to essentially “view” our image as a 2D array where each cell corresponds to some value stored in each pixel of the image.</p>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">eio</span> <span class="n">selfcheck</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'unzip' not found or not usable.
</code></pre></div></div>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">eio</span> <span class="n">clip</span> <span class="o">-</span><span class="n">o</span> <span class="n">Shasta</span><span class="o">-</span><span class="mi">30</span><span class="n">m</span><span class="o">-</span><span class="n">DEM</span><span class="p">.</span><span class="n">tif</span> <span class="o">--</span><span class="n">bounds</span> <span class="o">-</span><span class="mf">122.6</span> <span class="mf">41.15</span> <span class="o">-</span><span class="mf">121.9</span> <span class="mf">41.6</span> 
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make: Entering directory '/root/.cache/elevation/SRTM1'
curl -s -o spool/N41/N41W123.hgt.gz.temp https://s3.amazonaws.com/elevation-tiles-prod/skadi/N41/N41W123.hgt.gz &amp;&amp; mv spool/N41/N41W123.hgt.gz.temp spool/N41/N41W123.hgt.gz
gunzip spool/N41/N41W123.hgt.gz 2&gt;/dev/null || touch spool/N41/N41W123.hgt
gdal_translate -q -co TILED=YES -co COMPRESS=DEFLATE -co ZLEVEL=9 -co PREDICTOR=2 spool/N41/N41W123.hgt cache/N41/N41W123.tif 2&gt;/dev/null || touch cache/N41/N41W123.tif
curl -s -o spool/N41/N41W122.hgt.gz.temp https://s3.amazonaws.com/elevation-tiles-prod/skadi/N41/N41W122.hgt.gz &amp;&amp; mv spool/N41/N41W122.hgt.gz.temp spool/N41/N41W122.hgt.gz
gunzip spool/N41/N41W122.hgt.gz 2&gt;/dev/null || touch spool/N41/N41W122.hgt
gdal_translate -q -co TILED=YES -co COMPRESS=DEFLATE -co ZLEVEL=9 -co PREDICTOR=2 spool/N41/N41W122.hgt cache/N41/N41W122.tif 2&gt;/dev/null || touch cache/N41/N41W122.tif
rm spool/N41/N41W123.hgt spool/N41/N41W122.hgt
make: Leaving directory '/root/.cache/elevation/SRTM1'
make: Entering directory '/root/.cache/elevation/SRTM1'
gdalbuildvrt -q -overwrite SRTM1.vrt cache/N41/N41W123.tif cache/N41/N41W122.tif
make: Leaving directory '/root/.cache/elevation/SRTM1'
make: Entering directory '/root/.cache/elevation/SRTM1'
cp SRTM1.vrt SRTM1.a696d7f97ba14cb8b8f7fda62dc521e5.vrt
make: Leaving directory '/root/.cache/elevation/SRTM1'
make: Entering directory '/root/.cache/elevation/SRTM1'
gdal_translate -q -co TILED=YES -co COMPRESS=DEFLATE -co ZLEVEL=9 -co PREDICTOR=2 -projwin -122.6 41.6 -121.9 41.15 SRTM1.a696d7f97ba14cb8b8f7fda62dc521e5.vrt /root/earth-analytics-lessons/Shasta-30m-DEM.tif
rm -f SRTM1.a696d7f97ba14cb8b8f7fda62dc521e5.vrt
make: Leaving directory '/root/.cache/elevation/SRTM1'
</code></pre></div></div>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="s">"Shasta-30m-DEM.tif"</span>
<span class="n">gdal_data</span> <span class="o">=</span> <span class="n">gdal</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">gdal_band</span> <span class="o">=</span> <span class="n">gdal_data</span><span class="p">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nodataval</span> <span class="o">=</span> <span class="n">gdal_band</span><span class="p">.</span><span class="n">GetNoDataValue</span><span class="p">()</span>
<span class="n">data_array</span> <span class="o">=</span> <span class="n">gdal_data</span><span class="p">.</span><span class="n">ReadAsArray</span><span class="p">().</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
<span class="n">data_array</span>
</code></pre></div></div>

<div class="language-plaintext output execute_result highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array([[1066., 1064., 1064., ..., 1450., 1451., 1451.],
       [1067., 1065., 1064., ..., 1451., 1452., 1452.],
       [1067., 1065., 1064., ..., 1452., 1452., 1453.],
       ...,
       [1589., 1594., 1592., ..., 1089., 1091., 1093.],
       [1591., 1595., 1592., ..., 1069., 1068., 1070.],
       [1598., 1599., 1596., ..., 1049., 1048., 1051.]])
</code></pre></div></div>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># replace missing values if necessary
</span><span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nb">any</span><span class="p">(</span><span class="n">data_array</span> <span class="o">==</span> <span class="n">nodataval</span><span class="p">):</span>
    <span class="n">data_array</span><span class="p">[</span><span class="n">data_array</span> <span class="o">==</span> <span class="n">nodataval</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>

<span class="c1">#View the data we're using
</span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">"viridis"</span><span class="p">)</span>
</code></pre></div></div>

<figure class="output display_data">

<img src="https://earthdatascience.org/images/tutorials/python/2016-07-15-extract-raster-around-buffered-points/2016-07-15-extract-raster-around-buffered-points_7_0.png" alt="Image of elevation around Mt. Shasta." />
<figcaption>Image of elevation around Mt. Shasta.</figcaption>

</figure>

<p>Our goal is to extract information from this raster around a point. To define a spatial location, we need to know what the projection is for our digital elevation model. We can do this with the <code class="language-plaintext highlighter-rouge">GetProjection</code> method:</p>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prj</span> <span class="o">=</span> <span class="n">gdal_data</span><span class="p">.</span><span class="n">GetProjection</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">prj</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AXIS["Latitude",NORTH],AXIS["Longitude",EAST],AUTHORITY["EPSG","4326"]]
</code></pre></div></div>

<h2 id="extracting-raster-data-around-point-locations">Extracting raster data around point locations</h2>

<p>Now that we’ve read in our data, and we know what spatial coordinate system we are in, we’re ready to extract a subset of this data that we want to compute statistics on. In doing so, we’ll be able to get averages and other attributes from an area of our data as opposed to simply looking at individual values from pixels. Let’s extract these points from a circular buffer that we’ll place onto the data.</p>

<p>We’ll first need to define where to center our circle buffer. Let’s do this by using the central lat/lon coordinates for the city of Mt. Shasta, which we’ll get by using the GeoPy module.</p>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Find coordinates of where we want to center our circle
</span><span class="k">def</span> <span class="nf">get_latlon</span><span class="p">(</span><span class="n">city_name</span><span class="p">):</span>
    <span class="n">geolocator</span> <span class="o">=</span> <span class="n">Nominatim</span><span class="p">(</span><span class="n">user_agent</span><span class="o">=</span><span class="s">"raster-extraction-tutorial"</span><span class="p">)</span>
    <span class="n">latlon</span> <span class="o">=</span> <span class="n">geolocator</span><span class="p">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">city_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">latlon</span>

<span class="n">coords</span> <span class="o">=</span> <span class="n">get_latlon</span><span class="p">(</span><span class="s">"Mt. Shasta, CA"</span><span class="p">)</span>
<span class="n">coords</span>
</code></pre></div></div>

<div class="language-plaintext output execute_result highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Location(Mount Shasta, Siskiyou County, California, United States of America, (41.4091897, -122.1949533, 0.0))
</code></pre></div></div>

<p>Next, we need to find the row and column index for our point, which is currently defined as a latitude/longitidue tuple.</p>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Get row and column in raster based upon coordinates
#This is where we'll center the circle
</span><span class="k">def</span> <span class="nf">get_coords_at_point</span><span class="p">(</span><span class="n">rasterfile</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="n">gdata</span> <span class="o">=</span> <span class="n">gdal</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="n">rasterfile</span><span class="p">)</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">gdata</span><span class="p">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gdata</span><span class="p">.</span><span class="n">ReadAsArray</span><span class="p">().</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span>

<span class="n">radius</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1"># in units of pixels
</span>
<span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">get_coords_at_point</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
<span class="n">circle</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Extract the points within the circle
</span><span class="k">def</span> <span class="nf">points_in_circle</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
    <span class="n">buffer_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i0</span><span class="p">,</span> <span class="n">j0</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">circle</span>
    
    <span class="k">def</span> <span class="nf">int_ceiling</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">int_ceiling</span><span class="p">(</span><span class="n">i0</span> <span class="o">-</span> <span class="n">r</span><span class="p">),</span> <span class="n">int_ceiling</span><span class="p">(</span><span class="n">i0</span> <span class="o">+</span> <span class="n">r</span><span class="p">)):</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">i0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">int_ceiling</span><span class="p">(</span><span class="n">j0</span> <span class="o">-</span> <span class="n">ri</span><span class="p">),</span> <span class="n">int_ceiling</span><span class="p">(</span><span class="n">j0</span> <span class="o">+</span> <span class="n">ri</span><span class="p">)):</span>
            <span class="n">buffer_points</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>
    
    <span class="k">return</span> <span class="n">buffer_points</span>

<span class="n">buffer_points</span> <span class="o">=</span> <span class="n">points_in_circle</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">data_array</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"off"</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s">"viridis"</span><span class="p">)</span>
</code></pre></div></div>

<figure class="output display_data">

<img src="https://earthdatascience.org/images/tutorials/python/2016-07-15-extract-raster-around-buffered-points/2016-07-15-extract-raster-around-buffered-points_15_0.png" alt="A point near the peak of Mt. Shasta." />
<figcaption>A point near the peak of Mt. Shasta.</figcaption>

</figure>

<h2 id="compute-statistics">Compute Statistics</h2>

<p>Now that we have all of the values within the buffer/area, we can use NumPy to compute statistics such as mean, standard deviation, and variance on the data.</p>

<div class="language-python input highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">buffer_points</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">buffer_points</span><span class="p">)</span>
<span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nanvar</span><span class="p">(</span><span class="n">buffer_points</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Mean: %.2f"</span> <span class="o">%</span> <span class="n">mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Standard Deviation: %.2f"</span> <span class="o">%</span> <span class="n">std</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Variance: %.2f"</span> <span class="o">%</span> <span class="n">variance</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mean: 3746.62
Standard Deviation: 231.50
Variance: 53592.80
</code></pre></div></div>


          

        

        <!-- if the page is a course lesson, add pagination -->

        
      </section>

      <footer class="page__meta">
        
        









        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-20">April 20, 2020</time></p>
        
        <!-- Add license information w/ DOI to the bottom -->
        
  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  


      </footer>

      


<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://earthdatascience.org/tutorials/extract-raster-around-buffered-points/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
<br><br>
  <a href="https://earthlab.colorado.edu/earth-data-analytics-professional-graduate-certificate?utm_source=earthdatascience&utm_medium=website&utm_campaign=certificate-2022&utm_id=certificate-2022" target="_blank">
    <img src="https://earthdatascience.org/images/earth-data-analytics-professional-certificate-banner.png" alt="Get a professional Certificate in Earth Data Analytics at University of Colorado, Boulder" width="40%"></a>
</section>


       
    </div>

    
      


<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          




<div class="grid__item">
  
    <a href="https://earthdatascience.org/courses/earth-analytics-bootcamp/plot-data-python">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Plot Data With Matplotlib
</h2>


     
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">

     This Week

  


</p>
    </article>
  </a>
</div>

        
          




<div class="grid__item">
  
    <a href="https://earthdatascience.org/courses/use-data-open-source-python/hierarchical-data-formats-hdf/summarize-climate-data-by-season/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Calculate Seasonal Summary Values from Climate Data Variables Stored in NetCDF 4 Format: Work With MACA v2 Climate Data in Python
</h2>


     
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  26 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Learn how to calculate seasonal summary values for MACA 2 climate data using xarray and region mask in open source Python.
</p>
    </article>
  </a>
</div>

        
          




<div class="grid__item">
  
    <a href="https://earthdatascience.org/courses/use-data-open-source-python/hierarchical-data-formats-hdf/subset-netcdf4-climate-data-spatially-aoi/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Calculate Summary Values Using Spatial Areas of Interest (AOIs) including Shapefiles for Climate Data Variables Stored in NetCDF 4 Format: Work With MACA v2 Climate Data in Python
</h2>


     
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  32 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Climate datasets stored in netcdf 4 format often cover the entire globe or an entire country. Learn how to subset climate data spatially and by time slices u...</p>
    </article>
  </a>
</div>

        
          




<div class="grid__item">
  
    <a href="https://earthdatascience.org/courses/use-data-open-source-python/hierarchical-data-formats-hdf/use-netcdf-in-python-xarray/">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">How to Open and Process NetCDF 4 Data Format in Open Source Python
</h2>


     
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  26 minute read
	
</p>
      
      <p class="archive__item-excerpt" itemprop="description">Historic and projected climate data are most often stored in netcdf 4 format. Learn how to open and process MACA version 2 climate data for the Continental U...</p>
    </article>
  </a>
</div>

        
      </div>
    </div>
  
</div>



    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->


<!-- Adding analytics code -->

        



<div class="page__footer-follow">
  <ul class="social-icons">
    <li>
      <strong>&copy; 2025 Earth Lab -
      <a href="https://earthdatascience.org/license"> All materials on this site
        are subject to the CC BY-SA 4.0 License. </a>
      </strong>
    </li>
  </ul>
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/earthlabcu"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/earthlab"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://earthdatascience.org/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<!--
<div class="page__footer-copyright">Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
-->

      </footer>
    </div>

    <script src="https://earthdatascience.org/assets/js/main.min.js"></script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'earthlabcu';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





<script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-84081999-1', 'auto');
    ga('send', 'pageview');
</script>



  </body>
</html>

